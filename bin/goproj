#!/bin/bash
set -e

VERSION="0.1.0"

usage() {
  cat <<EOF
Usage: goproj COMMAND [options*]

Simplify Go(lang) development by providing a set of tools built around the
original go tool.

Commands:
    init    Print a shell setup you can append to your ~/.bashrc or ~/.bash_profile
    new     Creates a new project structure.
    run     Run the a given command with GOPATH set to the project directory.

Examples:
    goproj new

EOF
}

prefix() {
    local dir=$(cd -P "$(dirname "${BASH_SOURCE[0]}")/../" && pwd)
    echo $dir
}

libexec() {
  echo "$(prefix)/libexec"
}

run() {
  local cmd="${1}"

  if [[ ! $cmd ]]; then
    usage
    exit 0
  else
    local bin="$(basename $0)-${cmd}"
    PATH="$(libexec):${PATH}"

    if which $bin > /dev/null; then
      shift
      env GOPROJ_PREFIX="$(prefix)" $bin $@
    else
      echo -e "Invalid command: ${cmd}\n"
      usage
      exit 1
    fi
  fi
}

run $@
